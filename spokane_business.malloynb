>>>markdown
<<<<<<< HEAD
MBSUS 622 - Spokane Business Data
=======

Darren Owsley, MBSUS 622 - Spokane Business Data
>>>>>>> ca79afdf1a1538957951894ea8f32f2ae77d1c75
>>>malloy

source: naics_code is duckdb.table('./naics.csv') extend {
    rename: Business_Type is title
    primary_key: ncode
}

source: businesses is duckdb.table('./SpokaneCounty-Businesses.csv') extend {
  
    rename: ctype is `Customer Type`

    dimension: Commence_Date is strptime!date(`Commence Date`, '%b-%d-%Y')
    dimension: ReOpen_Date is strptime!date(`Reopen Date`, '%b-%d-%Y')
    dimension: location_city_clean is 
        pick 'SPOKANE VALLEY' when `Location City` = 'CITY OF SPOKANE VALLEY'
        pick 'SPOKANE VALLEY' when `Location City` = 'SPOKANE VLY'
        pick 'SPOKANE VALLEY' when `Location City` = 'SPOKANE VALEY'
        pick 'SPOKANE VALLEY' when `Location City` = 'SPOKANE VALLELY'
        pick 'SPOKANE VALLEY' when `Location City` = 'VALLEY'
        pick 'CHENEY' when `Location City` = 'CHEANEY'
        pick 'LIBERTY LAKE' when `Location City` = 'LIBERY LAKE'
        pick 'NINE MILE FALLS' when `Location City` = 'NINE MILE FLS'
        pick 'FAIRCHILD AIR FORCE BASE' when `Location City` = 'FAIRCHILD AFB'
        pick 'ELK' when `Location City` = 'ELK, WA.'
        pick 'SPOKANE' when `Location City` = 'SPOAKNE'
        pick 'SPOKANE' when `Location City` = 'SPOKEANE'
        else `Location City`

    
    measure: naics_count is count()

    join_one: naics_code with NAICS
}
>>>malloy

run: businesses -> {
    group_by:  ctype
    aggregate: naics_count is count()
}
>>>markdown

Number and type of businesses by year
>>>malloy

run: businesses -> {
    group_by:  naics_code.Business_Type
    aggregate: naics_count is count()
    nest: customer_by_type is {
        group_by: ctype
        aggregate: naics_count is count()
    }
}
>>>markdown

Businesses opened this year by year and business type
>>>malloy

run: businesses -> {
    group_by:  Commence_Date.year
    nest: business_by_year is {
       group_by:  naics_code.Business_Type
       aggregate: naics_count
       where: Commence_Date = @2025
    }
}
>>>markdown

Business trend from 2014 - 2024
>>>malloy

run: businesses -> {
    group_by:  naics_code.Business_Type
    aggregate: naics_count
    # line_chart
    nest: business_trend is {
       group_by:  Commence_Date.year
       aggregate: naics_count
       where: Commence_Date > @2014 and Commence_Date <= @2024 
    }
}
>>>markdown

Businesses that reopened
>>>malloy

run: businesses -> {
    group_by:  Commence_Date.year
    --aggregate: naics_count
    where: ReOpen_Date is not null
    nest: Businesses_that_reopened is {
       group_by:  naics_code.Business_Type, Commence_Date, ReOpen_Date
    }
}
>>>markdown
##### When businesses in Spokane, Washington, have mailing addresses outside of the state of Washington, it could be due to several reasons, including:

###### Tax Advantages: Some businesses may establish mailing addresses in states with more favorable tax conditions. For example, states with no state income tax (like Nevada or Wyoming) might offer financial incentives for businesses to register or establish a presence there. By doing so, they could minimize state-level taxes or take advantage of other tax benefits.

###### Registered Agents: In some cases, businesses choose to use a registered agent service, which is often located outside the state of operation. These services help businesses maintain compliance with local laws and regulations, receive legal documents, and forward mail. This can be more efficient for businesses that operate in multiple states or even internationally.

###### Business Structure: Some businesses, especially larger corporations or franchises, may be structured to operate under a parent company or umbrella organization located in another state. This can be part of a broader corporate strategy that involves creating multiple legal entities in different locations, often for regulatory or operational efficiency.

###### Mailing Address for Privacy or Convenience: Some businesses prefer to keep their operational address private and may choose to use a mailing address in a different state, particularly if they are primarily an online business or do not have a brick-and-mortar location. This could be for privacy or to simplify operations.

###### Multi-State Operations: If the business operates in multiple states, they might use a central address in a state where they have a significant presence or where business operations are centralized, even if their physical storefront or office is in Spokane.

###### Cost Savings: Setting up a business entity or a mailing address in certain states can be more cost-effective due to cheaper rates for business services, lower business filing fees, or lower property taxes. Businesses sometimes choose states with lower operating costs as part of an overall strategy to reduce expenses.
>>>malloy
<<<<<<< HEAD
# dashboard
=======

>>>>>>> ca79afdf1a1538957951894ea8f32f2ae77d1c75
run: businesses -> {
    aggregate: `Businesses Registered outside of Washington` is naics_count
    where: `Mailing State` != 'WASHINGTON'
<<<<<<< HEAD
    nest: `Businesses Registration Outside of WA` is {
       group_by:  `Business Type` is naics_code.Business_Type
       aggregate: `Businesses Opened` is naics_count
    }
    # shape_map
    nest: `By State (Data is from 2014-2025)` is {
        group_by:  `State` is `Mailing State`
        aggregate: `Business Count` is naics_count
    }
    # line_chart
    nest: `Business Trend - Overall businesses with mailing addresses outside of Washington have been trending up. There was a small decline since Covid.` is {
        group_by:  `Year Opened` is Commence_Date.year
        aggregate: `Number of Businesses Opened` is naics_count
        where: Commence_Date.year <= @2024 
    }

    # bar_chart
    nest: `Business Trend since COVID` is {
        group_by:  `Year Opened` is Commence_Date.year
        aggregate: `Number of Businesses Opened` is naics_count
        where: Commence_Date.year <= @2024 and Commence_Date >= @2020
        order_by: `Year Opened` asc
=======
    nest: Businesses_that_reopened is {
       group_by:  naics_code.Business_Type, Commence_Date
       limit: 3
>>>>>>> ca79afdf1a1538957951894ea8f32f2ae77d1c75
    }
}
>>>malloy

# line_chart
run: businesses -> {
    group_by:  Commence_Date.year
    aggregate: naics_count
    where: Commence_Date > @2014 and Commence_Date <= @2024 
}
>>>markdown
Business types by Location City (only WA)
>>>malloy
run: businesses -> {
    group_by: location_city_clean
    aggregate: num_business is count()
    where: `Location State` = 'WASHINGTON'
    nest: top_naics is {
        group_by:  naics_code.Business_Type
        aggregate: naics_count 
        limit: 3
    }
}